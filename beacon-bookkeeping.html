<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Beacon of New Beginnings - Bookkeeping Dashboard</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}
body {
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
padding: 20px;
min-height: 100vh;
}
.container {
max-width: 1400px;
margin: 0 auto;
background: white;
border-radius: 12px;
box-shadow: 0 20px 60px rgba(0,0,0,0.3);
overflow: hidden;
}
.header {
background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
color: white;
padding: 30px;
text-align: center;
}
.header h1 {
font-size: 32px;
margin-bottom: 5px;
}
.header .subtitle {
font-size: 18px;
opacity: 0.95;
margin-bottom: 5px;
}
.header p {
opacity: 0.85;
font-size: 14px;
}
.controls {
padding: 20px 30px;
background: #f8f9fa;
border-bottom: 2px solid #e9ecef;
display: flex;
gap: 15px;
flex-wrap: wrap;
align-items: center;
}
.currency-toggle {
display: flex;
gap: 10px;
margin-left: auto;
}
.currency-btn {
padding: 8px 16px;
border: 2px solid #6366f1;
background: white;
color: #6366f1;
border-radius: 6px;
font-size: 14px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s;
}
.currency-btn.active {
background: #6366f1;
color: white;
}
.btn {
padding: 12px 24px;
border: none;
border-radius: 6px;
font-size: 14px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s;
display: inline-flex;
align-items: center;
gap: 8px;
}
.btn-primary {
background: #6366f1;
color: white;
}
.btn-primary:hover {
background: #4f46e5;
transform: translateY(-2px);
box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
}
.btn-success {
background: #10b981;
color: white;
}
.btn-success:hover {
background: #059669;
transform: translateY(-2px);
box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
}
.btn-danger {
background: #ef4444;
color: white;
}
.btn-danger:hover {
background: #dc2626;
}
.btn-warning {
background: #f59e0b;
color: white;
}
.btn-warning:hover {
background: #d97706;
}
.content {
padding: 30px;
}
.summary-cards {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
gap: 20px;
margin-bottom: 30px;
}
.card {
background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
color: white;
padding: 25px;
border-radius: 10px;
box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}
.card.green {
background: linear-gradient(135deg, #10b981 0%, #059669 100%);
}
.card.orange {
background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
}
.card.purple {
background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
}
.card h3 {
font-size: 14px;
opacity: 0.9;
margin-bottom: 10px;
text-transform: uppercase;
letter-spacing: 1px;
}
.card .amount {
font-size: 36px;
font-weight: bold;
}
.card .currency-amounts {
font-size: 16px;
opacity: 0.9;
margin-top: 8px;
}
table {
width: 100%;
border-collapse: collapse;
margin-top: 20px;
background: white;
box-shadow: 0 2px 8px rgba(0,0,0,0.1);
border-radius: 8px;
overflow: hidden;
}
thead {
background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
color: white;
}
th {
padding: 15px;
text-align: left;
font-weight: 600;
font-size: 13px;
text-transform: uppercase;
letter-spacing: 0.5px;
}
td {
padding: 12px 15px;
border-bottom: 1px solid #e9ecef;
}
tbody tr:hover {
background: #f8f9fa;
}
input, select, textarea {
padding: 8px 12px;
border: 2px solid #e9ecef;
border-radius: 6px;
font-size: 14px;
width: 100%;
transition: border-color 0.3s;
font-family: inherit;
}
textarea {
min-height: 80px;
resize: vertical;
}
input:focus, select:focus, textarea:focus {
outline: none;
border-color: #6366f1;
}
.status-badge {
padding: 4px 12px;
border-radius: 20px;
font-size: 12px;
font-weight: 600;
display: inline-block;
}
.status-paid {
background: #d1fae5;
color: #065f46;
}
.status-pending {
background: #fed7aa;
color: #92400e;
}
.delete-btn {
background: #ef4444;
color: white;
border: none;
padding: 6px 12px;
border-radius: 4px;
cursor: pointer;
font-size: 12px;
}
.delete-btn:hover {
background: #dc2626;
}
.edit-btn {
background: #6366f1;
color: white;
border: none;
padding: 6px 12px;
border-radius: 4px;
cursor: pointer;
font-size: 12px;
margin-right: 5px;
}
.edit-btn:hover {
background: #4f46e5;
}
.modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0,0,0,0.5);
z-index: 1000;
align-items: center;
justify-content: center;
overflow-y: auto;
}
.modal.active {
display: flex;
}
.modal-content {
background: white;
padding: 30px;
border-radius: 12px;
max-width: 600px;
width: 90%;
max-height: 90vh;
overflow-y: auto;
margin: 20px;
}
.modal-content h2 {
margin-bottom: 20px;
color: #6366f1;
}
.form-group {
margin-bottom: 15px;
}
.form-group label {
display: block;
margin-bottom: 5px;
font-weight: 600;
color: #374151;
}
.currency-input-group {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 10px;
}
.form-row {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 15px;
}
.filter-section {
background: #f8f9fa;
padding: 20px;
border-radius: 8px;
margin-bottom: 20px;
display: grid;
grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
gap: 15px;
}
.login-overlay {
position: fixed;
top: 0;
left: 0;
right: 0;
bottom: 0;
background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
display: flex;
justify-content: center;
align-items: center;
z-index: 10000;
}
.login-box {
background: white;
padding: 40px;
border-radius: 12px;
box-shadow: 0 20px 60px rgba(0,0,0,0.3);
max-width: 400px;
width: 90%;
}
.login-box h2 {
color: #8b5cf6;
margin-bottom: 10px;
text-align: center;
}
.login-box p {
color: #666;
margin-bottom: 30px;
text-align: center;
font-size: 14px;
}
.login-input {
width: 100%;
padding: 12px;
border: 2px solid #e9ecef;
border-radius: 6px;
font-size: 16px;
margin-bottom: 20px;
}
.login-input:focus {
outline: none;
border-color: #8b5cf6;
}
.login-btn {
width: 100%;
padding: 12px;
background: #8b5cf6;
color: white;
border: none;
border-radius: 6px;
font-size: 16px;
font-weight: 600;
cursor: pointer;
transition: all 0.3s;
}
.login-btn:hover {
background: #7c3aed;
}
.login-error {
color: #ef4444;
font-size: 14px;
margin-top: 10px;
text-align: center;
display: none;
}
.dashboard-content {
display: none;
}
</style>
</head>
<body>
<div id="loginOverlay" class="login-overlay">
<div class="login-box">
<h2>üîí Admin Access</h2>
<p>Beacon of New Beginnings Bookkeeping Dashboard</p>
<input type="password" id="passwordInput" class="login-input" placeholder="Enter admin password" onkeypress="if(event.key==='Enter') checkPassword()">
<button class="login-btn" onclick="checkPassword()">üîì Login</button>
<div id="loginError" class="login-error">Incorrect password. Please try again.</div>
</div>
</div>
<div id="dashboardContent" class="dashboard-content">
<div class="container">
<div class="header">
<h1>üïäÔ∏è Beacon of New Beginnings</h1>
<div class="subtitle">Bookkeeping & Invoice Dashboard</div>
<p>Walking the path from pain to power - Financial Management System</p>
</div>

<div class="controls">
<button class="btn btn-primary" onclick="showAddModal()">‚ûï Add Expense</button>
<button class="btn btn-success" onclick="downloadExcel()">üì• Download Excel</button>
<button class="btn btn-success" onclick="downloadTemplate()">üìã Download Template</button>
<input type="file" id="fileInput" accept=".xlsx,.xls" style="display:none" onchange="importExcel(event)">
<button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">üì§ Import Excel</button>
<button class="btn btn-warning" onclick="clearAllData()">üóëÔ∏è Clear All</button>
<div class="currency-toggle">
<button class="currency-btn active" onclick="setCurrency('USD')" id="usdBtn">USD ($)</button>
<button class="currency-btn" onclick="setCurrency('GHS')" id="ghsBtn">GHS (‚Çµ)</button>
</div>
</div>

<div class="content">
<div class="filter-section">
<div class="form-group">
<label>Filter by Category</label>
<select id="filterCategory" onchange="filterTable()">
<option value="">All Categories</option>
</select>
</div>
<div class="form-group">
<label>Filter by Status</label>
<select id="filterStatus" onchange="filterTable()">
<option value="">All Status</option>
<option value="Paid">Paid</option>
<option value="Pending">Pending</option>
</select>
</div>
<div class="form-group">
<label>Search</label>
<input type="text" id="searchInput" placeholder="Search description, vendor..." oninput="filterTable()">
</div>
</div>

<div class="summary-cards">
<div class="card">
<h3>Total Expenses</h3>
<div class="amount" id="totalExpenses">$0.00</div>
<div class="currency-amounts" id="totalBoth">$0.00 / ‚Çµ0.00</div>
</div>
<div class="card green">
<h3>Paid</h3>
<div class="amount" id="paidAmount">$0.00</div>
<div class="currency-amounts" id="paidBoth">$0.00 / ‚Çµ0.00</div>
</div>
<div class="card orange">
<h3>Pending</h3>
<div class="amount" id="pendingAmount">$0.00</div>
<div class="currency-amounts" id="pendingBoth">$0.00 / ‚Çµ0.00</div>
</div>
<div class="card purple">
<h3>Exchange Rate</h3>
<div class="amount" style="font-size: 28px;">1 USD = <span id="exchangeRateDisplay">12.50</span> GHS</div>
<button class="btn btn-primary" style="margin-top: 10px; font-size: 12px;" onclick="updateExchangeRate()">Update Rate</button>
</div>
</div>

<table id="expenseTable">
<thead>
<tr>
<th>Date</th>
<th>Invoice #</th>
<th>Category</th>
<th>Description</th>
<th>Vendor/Payee</th>
<th>Amount (USD)</th>
<th>Amount (GHS)</th>
<th>Status</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="tableBody">
</tbody>
</table>
</div>
</div>

<div class="modal" id="addModal">
<div class="modal-content">
<h2 id="modalTitle">Add New Expense</h2>
<div class="form-row">
<div class="form-group">
<label>Date</label>
<input type="date" id="newDate" value="">
</div>
<div class="form-group">
<label>Invoice #</label>
<input type="text" id="newInvoice" placeholder="Auto-generated">
</div>
</div>
<div class="form-group">
<label>Category</label>
<select id="newCategory">
<option>Legal & Registration</option>
<option>Office Setup</option>
<option>Technology</option>
<option>Software</option>
<option>App Development</option>
<option>App Maintenance</option>
<option>Website & App Maintenance</option>
<option>Branding & SEO</option>
<option>Website Development</option>
<option>Website Hosting</option>
<option>Email Setup</option>
<option>Transportation</option>
<option>Intern Stipends</option>
<option>Secretary Stipends</option>
<option>Volunteer Stipends</option>
<option>Staff Salaries</option>
<option>Marketing</option>
<option>Marketing & Awareness</option>
<option>Launch Expenses</option>
<option>Google Workspace</option>
<option>Canva</option>
<option>Slack</option>
<option>Anthropic</option>
<option>Program Services</option>
<option>Community Outreach</option>
<option>Victim Support</option>
<option>Crisis Intervention</option>
<option>Counseling Services</option>
<option>Legal Aid</option>
<option>Housing Assistance</option>
<option>Office Rent</option>
<option>Utilities</option>
<option>Office Supplies</option>
<option>Fundraising Events</option>
<option>Training & Development</option>
<option>Professional Services</option>
<option>Insurance</option>
<option>Emergency Fund</option>
<option>Donations & Grants</option>
<option>Other</option>
</select>
</div>
<div class="form-group">
<label>Description</label>
<textarea id="newDescription" placeholder="Detailed description of expense"></textarea>
</div>
<div class="form-group">
<label>Vendor/Payee</label>
<input type="text" id="newVendor" placeholder="Name of vendor or payee">
</div>
<div class="form-group">
<label>Amount</label>
<div class="currency-input-group">
<div>
<label style="font-size: 12px; margin-bottom: 3px;">USD ($)</label>
<input type="number" id="newAmountUSD" step="0.01" placeholder="0.00" oninput="convertCurrency('usd')">
</div>
<div>
<label style="font-size: 12px; margin-bottom: 3px;">GHS (‚Çµ)</label>
<input type="number" id="newAmountGHS" step="0.01" placeholder="0.00" oninput="convertCurrency('ghs')">
</div>
</div>
</div>
<div class="form-group">
<label>Status</label>
<select id="newStatus">
<option>Pending</option>
<option>Paid</option>
</select>
</div>
<div class="form-group">
<label>Notes (Optional)</label>
<textarea id="newNotes" placeholder="Additional notes..." style="min-height: 60px;"></textarea>
</div>
<div class="form-group">
<label>Invoice/Receipt Attachment</label>
<input type="file" id="invoiceFile" accept="image/*,.pdf,.doc,.docx" onchange="handleFileSelect(event)" style="padding: 8px; border: 2px dashed #8b5cf6; border-radius: 6px; background: #f5f3ff;">
<div id="filePreview" style="margin-top: 10px; display: none;">
<div style="display: flex; align-items: center; gap: 10px; padding: 10px; background: #f5f3ff; border-radius: 6px; border: 1px solid #8b5cf6;">
<span id="fileName" style="font-size: 14px; color: #7c3aed; font-weight: 600;"></span>
<button type="button" onclick="removeFile()" style="margin-left: auto; padding: 4px 8px; background: #ef4444; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">Remove</button>
</div>
<img id="imagePreview" style="max-width: 200px; max-height: 200px; margin-top: 10px; border-radius: 6px; display: none;">
</div>
</div>
<div style="display: flex; gap: 10px; margin-top: 20px;">
<button class="btn btn-success" onclick="saveExpense()">üíæ Save Expense</button>
<button class="btn btn-danger" onclick="closeModal()">Cancel</button>
</div>
</div>
</div>

<script>
let expenses = [];
let currentCurrency = 'USD';
let exchangeRate = 12.50;
let editingIndex = -1;
let currentFileData = null;
let currentFileName = null;

// Load data from localStorage
function loadData() {
const savedExpenses = localStorage.getItem('beaconExpenses');
const savedRate = localStorage.getItem('beaconExchangeRate');
if (savedExpenses) {
expenses = JSON.parse(savedExpenses);
}
if (savedRate) {
exchangeRate = parseFloat(savedRate);
document.getElementById('exchangeRateDisplay').textContent = exchangeRate.toFixed(2);
}
populateCategoryFilter();
renderTable();
}

// Save data to localStorage
function saveData() {
localStorage.setItem('beaconExpenses', JSON.stringify(expenses));
localStorage.setItem('beaconExchangeRate', exchangeRate.toString());
}

function populateCategoryFilter() {
const categories = [...new Set(expenses.map(e => e.category))];
const categorySelect = document.getElementById('newCategory');
const filterSelect = document.getElementById('filterCategory');
const defaultCategories = Array.from(categorySelect.options).map(o => o.value);

const allCategories = [...new Set([...defaultCategories, ...categories])].sort();
filterSelect.innerHTML = '<option value="">All Categories</option>';
allCategories.forEach(cat => {
filterSelect.innerHTML += `<option value="${cat}">${cat}</option>`;
});
}

function setCurrency(currency) {
currentCurrency = currency;
document.getElementById('usdBtn').classList.toggle('active', currency === 'USD');
document.getElementById('ghsBtn').classList.toggle('active', currency === 'GHS');
updateSummary();
}

function updateExchangeRate() {
const newRate = prompt('Enter new exchange rate (1 USD = X GHS):', exchangeRate);
if (newRate && !isNaN(newRate) && parseFloat(newRate) > 0) {
exchangeRate = parseFloat(newRate);
document.getElementById('exchangeRateDisplay').textContent = exchangeRate.toFixed(2);
saveData();
renderTable();
}
}

function convertCurrency(from) {
const usdInput = document.getElementById('newAmountUSD');
const ghsInput = document.getElementById('newAmountGHS');
if (from === 'usd') {
const usd = parseFloat(usdInput.value) || 0;
ghsInput.value = (usd * exchangeRate).toFixed(2);
} else {
const ghs = parseFloat(ghsInput.value) || 0;
usdInput.value = (ghs / exchangeRate).toFixed(2);
}
}

function filterTable() {
const category = document.getElementById('filterCategory').value;
const status = document.getElementById('filterStatus').value;
const search = document.getElementById('searchInput').value.toLowerCase();

let filtered = expenses;
if (category) filtered = filtered.filter(e => e.category === category);
if (status) filtered = filtered.filter(e => e.status === status);
if (search) {
filtered = filtered.filter(e =>
e.description.toLowerCase().includes(search) ||
e.vendor.toLowerCase().includes(search) ||
e.invoice.toLowerCase().includes(search)
);
}

renderTable(filtered);
}

function renderTable(data = expenses) {
const tbody = document.getElementById('tableBody');
tbody.innerHTML = '';

data.forEach((exp, index) => {
const actualIndex = expenses.indexOf(exp);
const row = tbody.insertRow();
const attachmentIcon = exp.fileName ? `<span style="cursor: pointer;" onclick="viewAttachment(${actualIndex})" title="View attachment: ${exp.fileName}">üìé</span> ` : '';
row.innerHTML = `
<td>${exp.date}</td>
<td><strong>${exp.invoice}</strong> ${attachmentIcon}</td>
<td>${exp.category}</td>
<td>${exp.description}</td>
<td>${exp.vendor}</td>
<td><strong>$${exp.amountUSD.toFixed(2)}</strong></td>
<td><strong>‚Çµ${exp.amountGHS.toFixed(2)}</strong></td>
<td><span class="status-badge status-${exp.status.toLowerCase()}">${exp.status}</span></td>
<td>
<button class="edit-btn" onclick="editExpense(${actualIndex})">Edit</button>
<button class="delete-btn" onclick="deleteExpense(${actualIndex})">Delete</button>
</td>
`;
});

updateSummary();
}

function updateSummary() {
const totalUSD = expenses.reduce((sum, exp) => sum + exp.amountUSD, 0);
const totalGHS = expenses.reduce((sum, exp) => sum + exp.amountGHS, 0);
const paidUSD = expenses.filter(e => e.status === 'Paid').reduce((sum, exp) => sum + exp.amountUSD, 0);
const paidGHS = expenses.filter(e => e.status === 'Paid').reduce((sum, exp) => sum + exp.amountGHS, 0);
const pendingUSD = expenses.filter(e => e.status === 'Pending').reduce((sum, exp) => sum + exp.amountUSD, 0);
const pendingGHS = expenses.filter(e => e.status === 'Pending').reduce((sum, exp) => sum + exp.amountGHS, 0);

if (currentCurrency === 'USD') {
document.getElementById('totalExpenses').textContent = `$${totalUSD.toFixed(2)}`;
document.getElementById('paidAmount').textContent = `$${paidUSD.toFixed(2)}`;
document.getElementById('pendingAmount').textContent = `$${pendingUSD.toFixed(2)}`;
} else {
document.getElementById('totalExpenses').textContent = `‚Çµ${totalGHS.toFixed(2)}`;
document.getElementById('paidAmount').textContent = `‚Çµ${paidGHS.toFixed(2)}`;
document.getElementById('pendingAmount').textContent = `‚Çµ${pendingGHS.toFixed(2)}`;
}

document.getElementById('totalBoth').textContent = `$${totalUSD.toFixed(2)} / ‚Çµ${totalGHS.toFixed(2)}`;
document.getElementById('paidBoth').textContent = `$${paidUSD.toFixed(2)} / ‚Çµ${paidGHS.toFixed(2)}`;
document.getElementById('pendingBoth').textContent = `$${pendingUSD.toFixed(2)} / ‚Çµ${pendingGHS.toFixed(2)}`;
}

function showAddModal() {
editingIndex = -1;
document.getElementById('modalTitle').textContent = 'Add New Expense';
document.getElementById('newDate').value = new Date().toISOString().split('T')[0];
document.getElementById('newInvoice').value = '';
document.getElementById('newCategory').selectedIndex = 0;
document.getElementById('newDescription').value = '';
document.getElementById('newVendor').value = '';
document.getElementById('newAmountUSD').value = '';
document.getElementById('newAmountGHS').value = '';
document.getElementById('newStatus').selectedIndex = 0;
document.getElementById('newNotes').value = '';
document.getElementById('invoiceFile').value = '';
currentFileData = null;
currentFileName = null;
document.getElementById('filePreview').style.display = 'none';
document.getElementById('addModal').classList.add('active');
}

function editExpense(index) {
editingIndex = index;
const exp = expenses[index];
document.getElementById('modalTitle').textContent = 'Edit Expense';
document.getElementById('newDate').value = exp.date;
document.getElementById('newInvoice').value = exp.invoice;
document.getElementById('newCategory').value = exp.category;
document.getElementById('newDescription').value = exp.description;
document.getElementById('newVendor').value = exp.vendor;
document.getElementById('newAmountUSD').value = exp.amountUSD;
document.getElementById('newAmountGHS').value = exp.amountGHS;
document.getElementById('newStatus').value = exp.status;
document.getElementById('newNotes').value = exp.notes || '';
currentFileData = exp.fileData || null;
currentFileName = exp.fileName || null;
if (currentFileName) {
document.getElementById('fileName').textContent = currentFileName;
document.getElementById('filePreview').style.display = 'block';
if (exp.fileData && exp.fileData.startsWith('data:image')) {
document.getElementById('imagePreview').src = exp.fileData;
document.getElementById('imagePreview').style.display = 'block';
}
} else {
document.getElementById('filePreview').style.display = 'none';
}
document.getElementById('addModal').classList.add('active');
}

function closeModal() {
document.getElementById('addModal').classList.remove('active');
editingIndex = -1;
}

function saveExpense() {
const amountUSD = parseFloat(document.getElementById('newAmountUSD').value) || 0;
const amountGHS = parseFloat(document.getElementById('newAmountGHS').value) || 0;
const description = document.getElementById('newDescription').value.trim();

if (!description || (amountUSD <= 0 && amountGHS <= 0)) {
alert('Please fill in description and amount');
return;
}

const expense = {
date: document.getElementById('newDate').value,
invoice: document.getElementById('newInvoice').value || `BEA-${String(expenses.length + 1).padStart(4, '0')}`,
category: document.getElementById('newCategory').value,
description: description,
vendor: document.getElementById('newVendor').value.trim(),
amountUSD: amountUSD,
amountGHS: amountGHS,
status: document.getElementById('newStatus').value,
notes: document.getElementById('newNotes').value.trim(),
fileData: currentFileData,
fileName: currentFileName
};

if (editingIndex >= 0) {
expenses[editingIndex] = expense;
} else {
expenses.push(expense);
}

saveData();
populateCategoryFilter();
renderTable();
closeModal();
}

function handleFileSelect(event) {
const file = event.target.files[0];
if (!file) return;

const reader = new FileReader();
reader.onload = function(e) {
currentFileData = e.target.result;
currentFileName = file.name;
document.getElementById('fileName').textContent = file.name;
document.getElementById('filePreview').style.display = 'block';

if (file.type.startsWith('image/')) {
document.getElementById('imagePreview').src = e.target.result;
document.getElementById('imagePreview').style.display = 'block';
} else {
document.getElementById('imagePreview').style.display = 'none';
}
};
reader.readAsDataURL(file);
}

function removeFile() {
currentFileData = null;
currentFileName = null;
document.getElementById('invoiceFile').value = '';
document.getElementById('filePreview').style.display = 'none';
document.getElementById('imagePreview').style.display = 'none';
}

function viewAttachment(index) {
const exp = expenses[index];
if (exp.fileData) {
const newWindow = window.open();
if (exp.fileData.startsWith('data:image')) {
newWindow.document.write(`<html><head><title>${exp.fileName}</title></head><body style="margin:0;display:flex;justify-content:center;align-items:center;min-height:100vh;background:#000;"><img src="${exp.fileData}" style="max-width:100%;max-height:100vh;"></body></html>`);
} else if (exp.fileData.startsWith('data:application/pdf')) {
newWindow.document.write(`<html><head><title>${exp.fileName}</title></head><body style="margin:0;"><embed src="${exp.fileData}" width="100%" height="100%" type="application/pdf"></body></html>`);
} else {
const link = document.createElement('a');
link.href = exp.fileData;
link.download = exp.fileName;
link.click();
}
}
}

function deleteExpense(index) {
if (confirm('Are you sure you want to delete this expense?')) {
expenses.splice(index, 1);
saveData();
populateCategoryFilter();
renderTable();
}
}

function clearAllData() {
if (confirm('‚ö†Ô∏è WARNING: This will permanently delete ALL expense data. This cannot be undone. Are you sure?')) {
if (confirm('Are you ABSOLUTELY sure? This is your last chance to cancel.')) {
expenses = [];
saveData();
populateCategoryFilter();
renderTable();
alert('All data has been cleared.');
}
}
}

function downloadExcel() {
const wb = XLSX.utils.book_new();

const wsData = [
['BEACON OF NEW BEGINNINGS - BOOKKEEPING REPORT'],
['Generated: ' + new Date().toLocaleString()],
['Exchange Rate: 1 USD = ' + exchangeRate + ' GHS'],
[],
['Date', 'Invoice #', 'Category', 'Description', 'Vendor/Payee', 'Amount USD', 'Amount GHS', 'Status', 'Notes'],
...expenses.map(exp => [
exp.date,
exp.invoice,
exp.category,
exp.description,
exp.vendor,
exp.amountUSD,
exp.amountGHS,
exp.status,
exp.notes || ''
]),
[],
['SUMMARY'],
['Total Expenses (USD)', expenses.reduce((sum, exp) => sum + exp.amountUSD, 0)],
['Total Expenses (GHS)', expenses.reduce((sum, exp) => sum + exp.amountGHS, 0)],
['Paid (USD)', expenses.filter(e => e.status === 'Paid').reduce((sum, exp) => sum + exp.amountUSD, 0)],
['Paid (GHS)', expenses.filter(e => e.status === 'Paid').reduce((sum, exp) => sum + exp.amountGHS, 0)],
['Pending (USD)', expenses.filter(e => e.status === 'Pending').reduce((sum, exp) => sum + exp.amountUSD, 0)],
['Pending (GHS)', expenses.filter(e => e.status === 'Pending').reduce((sum, exp) => sum + exp.amountGHS, 0)]
];

const ws = XLSX.utils.aoa_to_sheet(wsData);
ws['!cols'] = [
{wch: 12}, {wch: 12}, {wch: 20}, {wch: 35}, {wch: 25}, {wch: 12}, {wch: 12}, {wch: 10}, {wch: 30}
];

XLSX.utils.book_append_sheet(wb, ws, "Expenses");

const categories = [...new Set(expenses.map(e => e.category))];
const categoryData = [
['CATEGORY BREAKDOWN'],
[],
['Category', 'Total USD', 'Total GHS'],
...categories.map(cat => [
cat,
expenses.filter(e => e.category === cat).reduce((sum, exp) => sum + exp.amountUSD, 0),
expenses.filter(e => e.category === cat).reduce((sum, exp) => sum + exp.amountGHS, 0)
])
];

const ws2 = XLSX.utils.aoa_to_sheet(categoryData);
ws2['!cols'] = [{wch: 30}, {wch: 15}, {wch: 15}];
XLSX.utils.book_append_sheet(wb, ws2, "Category Summary");

const filename = `Beacon_Bookkeeping_${new Date().toISOString().split('T')[0]}.xlsx`;
XLSX.writeFile(wb, filename);
}

function downloadTemplate() {
const wb = XLSX.utils.book_new();

const templateData = [
['BEACON OF NEW BEGINNINGS - IMPORT TEMPLATE'],
['Fill in your expenses below and import back into the system'],
['Exchange Rate Note: Current rate is 1 USD = ' + exchangeRate + ' GHS'],
[],
['Date', 'Invoice #', 'Category', 'Description', 'Vendor/Payee', 'Amount USD', 'Amount GHS', 'Status', 'Notes'],
['2024-12-04', 'BEA-0001', 'Program Services', 'Example expense', 'Vendor name', 100, 1250, 'Paid', 'Optional notes'],
[],
['AVAILABLE CATEGORIES:'],
['Program Services', 'Community Outreach', 'Victim Support', 'Crisis Intervention'],
['Counseling Services', 'Legal Aid', 'Housing Assistance', 'Staff Salaries'],
['Volunteer Stipends', 'Office Rent', 'Utilities', 'Office Supplies'],
['Technology & Software', 'Website & App Maintenance', 'Marketing & Awareness'],
['Fundraising Events', 'Training & Development', 'Professional Services'],
['Insurance', 'Transportation', 'Emergency Fund', 'Donations & Grants', 'Other']
];

const ws = XLSX.utils.aoa_to_sheet(templateData);
ws['!cols'] = [{wch: 12}, {wch: 12}, {wch: 25}, {wch: 35}, {wch: 25}, {wch: 12}, {wch: 12}, {wch: 10}, {wch: 30}];

XLSX.utils.book_append_sheet(wb, ws, "Template");
XLSX.writeFile(wb, 'Beacon_Import_Template.xlsx');
}

function importExcel(event) {
const file = event.target.files[0];
const reader = new FileReader();

reader.onload = function(e) {
const data = new Uint8Array(e.target.result);
const workbook = XLSX.read(data, {type: 'array'});
const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
const jsonData = XLSX.utils.sheet_to_json(firstSheet, {header: 1});

let headerIndex = -1;
for (let i = 0; i < jsonData.length; i++) {
if (jsonData[i][0] === 'Date' || jsonData[i].includes('Date')) {
headerIndex = i;
break;
}
}

if (headerIndex !== -1) {
const importedExpenses = [];
for (let i = headerIndex + 1; i < jsonData.length; i++) {
const row = jsonData[i];
if (row[0] && row[3] && (row[5] || row[6])) {
importedExpenses.push({
date: row[0],
invoice: row[1] || `BEA-${String(i).padStart(4, '0')}`,
category: row[2] || 'Other',
description: row[3],
vendor: row[4] || '',
amountUSD: parseFloat(row[5]) || 0,
amountGHS: parseFloat(row[6]) || 0,
status: row[7] || 'Pending',
notes: row[8] || ''
});
}
}

if (importedExpenses.length > 0) {
if (confirm(`Import ${importedExpenses.length} expenses? This will ADD to current data.`)) {
expenses = [...expenses, ...importedExpenses];
saveData();
populateCategoryFilter();
renderTable();
alert(`Successfully imported ${importedExpenses.length} expenses!`);
}
}
}
};

reader.readAsArrayBuffer(file);
event.target.value = '';
}

// Password protection
const ADMIN_PASSWORD = 'BeaconNGO2025!';

function checkPassword() {
const input = document.getElementById('passwordInput').value;
if (input === ADMIN_PASSWORD) {
document.getElementById('loginOverlay').style.display = 'none';
document.getElementById('dashboardContent').style.display = 'block';
sessionStorage.setItem('beaconAuth', 'true');
loadData();
} else {
document.getElementById('loginError').style.display = 'block';
document.getElementById('passwordInput').value = '';
setTimeout(() => {
document.getElementById('loginError').style.display = 'none';
}, 3000);
}
}

// Check if already authenticated in this session
if (sessionStorage.getItem('beaconAuth') === 'true') {
document.getElementById('loginOverlay').style.display = 'none';
document.getElementById('dashboardContent').style.display = 'block';
loadData();
}
</script>

</div>
</div>
</body>
</html>